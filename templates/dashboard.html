{% extends "base.html" %}
{% block body_class %}bg-main{% endblock %}
{% block content %}

<!--{% block page_nav %}
  <a href="{{ url_for('home') }}">Home</a>
  <a href="{{ url_for('calendar') }}">Calendar</a>
  <a href="{{ url_for('booking_new') }}">New Booking</a>
{% endblock %}-->

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Bookings</h3>
  <div>
    <a class="btn btn-sm btn-light" href="{{ url_for('home') }}">HOME</a>
    <a class="btn btn-sm btn-light" href="{{ url_for('calendar') }}">CALENDAR</a>
    <a class="btn btn-sm btn-light" href="{{ url_for('booking_new') }}">NEW BOOKING</a>
  </div>
</div>

<div class="card p-3">
  <div class="table-responsive">
    <table class="table table-dark table-striped">
      <thead>
        <tr><th>#</th><th>Name</th><th>From Date</th><th>To Date</th><th>From</th><th>To</th>
<th>Created</th></tr>
      </thead>
      <tbody>
        {% for b in bookings %}
          <tr>
            <td>{{ b.id }}</td>
           <td>
            <a href="#" class="link-light view-booking" data-id="{{ b.id }}">{{ b.name }}</a>
            <a href="{{ url_for('edit_booking', booking_id=b.id) }}" class="btn btn-sm btn-warning ms-2">Edit</a>
            <a href="{{ url_for('delete_booking', booking_id=b.id) }}" class="btn btn-sm btn-danger ms-1"
              onclick="return confirm('Are you sure you want to delete this booking?')">Delete</a>
            <a href="{{ url_for('download_receipt', booking_id=b.id) }}" class="btn btn-sm btn-outline-primary">Download PDF</a>

            </td>

           <td>{{ b.from_date.strftime('%Y-%m-%d') }}</td>
           <td>{{ b.to_date.strftime('%Y-%m-%d') }}</td>
           <td>{{ b.from_time }}</td>
           <td>{{ b.to_time }}</td>
           

            <td>{{ b.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          </tr>
        {% else %}
          <tr><td colspan="6">No bookings yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Booking Detail Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content p-3">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="modalTitle"></h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('click', function(e){
  if (e.target.matches('.view-booking')) {
    e.preventDefault();
    const id = e.target.dataset.id;
    fetch('/booking/' + id)
      .then(r=>r.json())
      .then(j=>{

        document.getElementById('modalTitle').innerText =`${j.name} — ${j.from_date} → ${j.to_date}`;
        document.getElementById('modalBody').innerHTML = `<p><strong>Date:</strong> ${j.from_date} → ${j.to_date}</p>
          <p><strong>Time:</strong> ${j.from_time} - ${j.to_time}</p>
          <p><strong>Details:</strong><br>${(j.details || '—')}</p>
          <p class="small text-muted">Created: ${new Date(j.created_at).toLocaleString()}</p>`;

        var modal = new bootstrap.Modal(document.getElementById('bookingModal'));
        modal.show();
      });
  }
});


</script>
{% endblock %}
